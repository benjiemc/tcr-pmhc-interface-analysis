

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pMHC movement between apo and holo conformations &mdash; tcr_pmhc_interface_analysis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Command Line Applications" href="apps.html" />
    <link rel="prev" title="pMHC movement based on peptide anchoring" href="pMHC_movement_based_on_peptide_anchoring.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tcr_pmhc_interface_analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Analysis Results</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="notebooks.html">Analysis Notebooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Ascertaining_the_generalisability_of_the_structure_data.html">Ascertaining the generalisability of the structure data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Centre_of_mass_analysis.html">Centre of mass analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="Comparing_of_apo_and_holo_CDR_loop_clustering.html">Comparing <em>apo</em> and <em>holo</em> CDR loop clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="Comparison_of_apo_and_holo_CDR_loops.html">Comparison of <em>apo</em> and **holo* CDR loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="Identify_contact_residues_on_MHC_Class_I_molecules.html">Identify contact residues on MHC Class I molecules</a></li>
<li class="toctree-l2"><a class="reference internal" href="Length_dependency_of_conformational_change.html">Length dependency of conformational change</a></li>
<li class="toctree-l2"><a class="reference internal" href="Per_residue_changes_of_TCR_CDR_between_apo_and_holo_structures.html">Per residue changes of TCR CDRs between apo and holo structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="Summary_of_apo_holo_data.html">Summary of <em>apo</em>-<em>holo</em> data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visualising_CDR_loop_clustering.html">Visualising CDR loop clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="pMHC_movement_based_on_peptide_anchoring.html">pMHC movement based on peptide anchoring</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">pMHC movement between apo and holo conformations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Load-comparisons">Load comparisons</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Load-summary-data">Load summary data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Annotate-results-with-summary-data">Annotate results with summary data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Visualise-results">Visualise results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Compute-Statistics">Compute Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Comparing-the-differences-in-binding-between-movement-types">Comparing the differences in binding between movement types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Command Line Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apps.html">Command Line Applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">tcr_pmhc_interface_analysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tcr_pmhc_interface_analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="notebooks.html">Analysis Notebooks</a></li>
      <li class="breadcrumb-item active">pMHC movement between apo and holo conformations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source/pMHC_movement_between_apo_and_holo_conformations.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pMHC-movement-between-apo-and-holo-conformations">
<h1>pMHC movement between apo and holo conformations<a class="headerlink" href="#pMHC-movement-between-apo-and-holo-conformations" title="Link to this heading"></a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading"></a></h2>
<p>In this notebook we aim to determine what parts of the pMHC, if any, move when contacted by TCRs. We split the MHC domain into MHC-non-TCR contact and MHC-TCR contact based on previous analysis of the TCR finger print on the MHC molecules.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>import itertools

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import scipy
import seaborn as sns
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>NOISE_LEVEL = 0.5 # Å
</pre></div>
</div>
</div>
</section>
<section id="Load-comparisons">
<h2>Load comparisons<a class="headerlink" href="#Load-comparisons" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results = pd.read_csv(&#39;../data/processed/apo-holo-tcr-pmhc-class-I-comparisons/pmhc_tcr_contact_apo_holo.csv&#39;)
results
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>complex_id</th>
      <th>structure_x_name</th>
      <th>structure_y_name</th>
      <th>chain_type</th>
      <th>tcr_contact</th>
      <th>rmsd</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3qdg_D-E-C-A-B_tcr_pmhc</td>
      <td>1jf1_A-B-C_pmhc.pdb</td>
      <td>3qdg_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>False</td>
      <td>0.630013</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3qdg_D-E-C-A-B_tcr_pmhc</td>
      <td>1jf1_A-B-C_pmhc.pdb</td>
      <td>3qdg_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>True</td>
      <td>0.582077</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7ow6_D-E-C-A-B_tcr_pmhc</td>
      <td>7ow4_A-B-C_pmhc.pdb</td>
      <td>7ow4_D-E-F_pmhc.pdb</td>
      <td>antigen_chain</td>
      <td>False</td>
      <td>0.349159</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7ow6_D-E-C-A-B_tcr_pmhc</td>
      <td>7ow4_A-B-C_pmhc.pdb</td>
      <td>7ow4_D-E-F_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>False</td>
      <td>0.306333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7ow6_D-E-C-A-B_tcr_pmhc</td>
      <td>7ow4_A-B-C_pmhc.pdb</td>
      <td>7ow4_D-E-F_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>True</td>
      <td>0.265103</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1989</th>
      <td>7rtr_D-E-C-A-B_tcr_pmhc</td>
      <td>7p3d_A-B-C_pmhc.pdb</td>
      <td>7rtr_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>False</td>
      <td>0.497769</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>7rtr_D-E-C-A-B_tcr_pmhc</td>
      <td>7p3d_A-B-C_pmhc.pdb</td>
      <td>7rtr_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>True</td>
      <td>0.458372</td>
    </tr>
    <tr>
      <th>1991</th>
      <td>7rtr_D-E-C-A-B_tcr_pmhc</td>
      <td>7rtd_A-B-C_pmhc.pdb</td>
      <td>7rtr_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>antigen_chain</td>
      <td>False</td>
      <td>0.455078</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>7rtr_D-E-C-A-B_tcr_pmhc</td>
      <td>7rtd_A-B-C_pmhc.pdb</td>
      <td>7rtr_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>False</td>
      <td>0.449558</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>7rtr_D-E-C-A-B_tcr_pmhc</td>
      <td>7rtd_A-B-C_pmhc.pdb</td>
      <td>7rtr_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>mhc_chain1</td>
      <td>True</td>
      <td>0.493225</td>
    </tr>
  </tbody>
</table>
<p>1994 rows × 6 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results_holo_holo = pd.read_csv(&#39;../data/processed/apo-holo-tcr-pmhc-class-I-comparisons/pmhc_tcr_contact_holo.csv&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results_holo_holo = results_holo_holo.query(&quot;chain_type == &#39;mhc_chain1&#39; or chain_type == &#39;antigen_chain&#39;&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results_holo_holo[&#39;mhc_slug&#39;] = None
results_holo_holo[&#39;peptide_sequence&#39;] = None
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>mhc_pattern = r&#39;^hla|h2&#39;
mhc_complex_ids = results_holo_holo[&#39;complex_id&#39;].str.contains(mhc_pattern, regex=True)

mhc_slug_peptides = results_holo_holo[mhc_complex_ids][&#39;complex_id&#39;].str.rsplit(&#39;_&#39;, n=1)
mhc_slugs = mhc_slug_peptides.map(lambda composite: composite[0])
peptides = mhc_slug_peptides.map(lambda composite: composite[1])

results_holo_holo.loc[mhc_complex_ids, &#39;mhc_slug&#39;] = mhc_slugs
results_holo_holo.loc[mhc_complex_ids, &#39;peptide_sequence&#39;] = peptides

results_holo_holo = results_holo_holo[mhc_complex_ids]
</pre></div>
</div>
</div>
</section>
<section id="Load-summary-data">
<h2>Load summary data<a class="headerlink" href="#Load-summary-data" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>apo_holo_summary_df = pd.read_csv(&#39;../data/processed/apo-holo-tcr-pmhc-class-I/apo_holo_summary.csv&#39;)
apo_holo_summary_df
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>file_name</th>
      <th>pdb_id</th>
      <th>structure_type</th>
      <th>state</th>
      <th>alpha_chain</th>
      <th>beta_chain</th>
      <th>antigen_chain</th>
      <th>mhc_chain1</th>
      <th>mhc_chain2</th>
      <th>cdr_sequences_collated</th>
      <th>peptide_sequence</th>
      <th>mhc_slug</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1ao7_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>1ao7</td>
      <td>tcr_pmhc</td>
      <td>holo</td>
      <td>D</td>
      <td>E</td>
      <td>C</td>
      <td>A</td>
      <td>B</td>
      <td>DRGSQS-IYSNGD-AVTTDSWGKLQ-MNHEY-SVGAGI-ASRPGLA...</td>
      <td>LLFGYPVYV</td>
      <td>hla_a_02_01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1bd2_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>1bd2</td>
      <td>tcr_pmhc</td>
      <td>holo</td>
      <td>D</td>
      <td>E</td>
      <td>C</td>
      <td>A</td>
      <td>B</td>
      <td>NSMFDY-ISSIKDK-AAMEGAQKLV-MNHEY-SVGAGI-ASSYPGG...</td>
      <td>LLFGYPVYV</td>
      <td>hla_a_02_01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1bii_A-B-P_pmhc.pdb</td>
      <td>1bii</td>
      <td>pmhc</td>
      <td>apo</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>P</td>
      <td>A</td>
      <td>B</td>
      <td>NaN</td>
      <td>RGPGRAFVTI</td>
      <td>h2_dd</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1ddh_A-B-P_pmhc.pdb</td>
      <td>1ddh</td>
      <td>pmhc</td>
      <td>apo</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>P</td>
      <td>A</td>
      <td>B</td>
      <td>NaN</td>
      <td>RGPGRAFVTI</td>
      <td>h2_dd</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1duz_A-B-C_pmhc.pdb</td>
      <td>1duz</td>
      <td>pmhc</td>
      <td>apo</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C</td>
      <td>A</td>
      <td>B</td>
      <td>NaN</td>
      <td>LLFGYPVYV</td>
      <td>hla_a_02_01</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>353</th>
      <td>8gon_D-E-C-A-B_tcr_pmhc.pdb</td>
      <td>8gon</td>
      <td>tcr_pmhc</td>
      <td>holo</td>
      <td>D</td>
      <td>E</td>
      <td>C</td>
      <td>A</td>
      <td>B</td>
      <td>TSESDYY-QEAYKQQN-ASSGNTPLV-SGHNS-FNNNVP-ASTWGR...</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>354</th>
      <td>8gop_A-B_tcr.pdb</td>
      <td>8gop</td>
      <td>tcr</td>
      <td>apo</td>
      <td>A</td>
      <td>B</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>TSESDYY-QEAYKQQN-ASSGNTPLV-SGHNS-FNNNVP-ASTWGR...</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>355</th>
      <td>8gvb_A-B-P-H-L_tcr_pmhc.pdb</td>
      <td>8gvb</td>
      <td>tcr_pmhc</td>
      <td>holo</td>
      <td>A</td>
      <td>B</td>
      <td>P</td>
      <td>H</td>
      <td>L</td>
      <td>YGATPY-YFSGDTLV-AVGFTGGGNKLT-SEHNR-FQNEAQ-ASSD...</td>
      <td>RYPLTFGW</td>
      <td>hla_a_24_02</td>
    </tr>
    <tr>
      <th>356</th>
      <td>8gvg_A-B-P-H-L_tcr_pmhc.pdb</td>
      <td>8gvg</td>
      <td>tcr_pmhc</td>
      <td>holo</td>
      <td>A</td>
      <td>B</td>
      <td>P</td>
      <td>H</td>
      <td>L</td>
      <td>YGATPY-YFSGDTLV-AVGFTGGGNKLT-SEHNR-FQNEAQ-ASSD...</td>
      <td>RFPLTFGW</td>
      <td>hla_a_24_02</td>
    </tr>
    <tr>
      <th>357</th>
      <td>8gvi_A-B-P-H-L_tcr_pmhc.pdb</td>
      <td>8gvi</td>
      <td>tcr_pmhc</td>
      <td>holo</td>
      <td>A</td>
      <td>B</td>
      <td>P</td>
      <td>H</td>
      <td>L</td>
      <td>YGATPY-YFSGDTLV-AVVFTGGGNKLT-SEHNR-FQNEAQ-ASSL...</td>
      <td>RYPLTFGW</td>
      <td>hla_a_24_02</td>
    </tr>
  </tbody>
</table>
<p>358 rows × 12 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>apo_holo_summary_df[&#39;ids&#39;] = apo_holo_summary_df[&#39;file_name&#39;].str.replace(&#39;.pdb$&#39;, &#39;&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/scratch/bmcmaste/1757795/ipykernel_1746162/477882467.py:1: FutureWarning: The default value of regex will change from True to False in a future version.
  apo_holo_summary_df[&#39;ids&#39;] = apo_holo_summary_df[&#39;file_name&#39;].str.replace(&#39;.pdb$&#39;, &#39;&#39;)
</pre></div></div>
</div>
<section id="Annotate-results-with-summary-data">
<h3>Annotate results with summary data<a class="headerlink" href="#Annotate-results-with-summary-data" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results = results.merge(apo_holo_summary_df[[&#39;ids&#39;, &#39;cdr_sequences_collated&#39;, &#39;peptide_sequence&#39;, &#39;mhc_slug&#39;]],
                        left_on=&#39;complex_id&#39;,
                        right_on=&#39;ids&#39;,
                        how=&#39;left&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results = pd.concat([results, results_holo_holo])
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results = results.merge(
    apo_holo_summary_df[[&#39;file_name&#39;, &#39;pdb_id&#39;, &#39;structure_type&#39;, &#39;state&#39;]],
    how=&#39;left&#39;,
    left_on=&#39;structure_x_name&#39;,
    right_on=&#39;file_name&#39;,
).merge(
    apo_holo_summary_df[[&#39;file_name&#39;, &#39;pdb_id&#39;, &#39;structure_type&#39;, &#39;state&#39;]],
    how=&#39;left&#39;,
    left_on=&#39;structure_y_name&#39;,
    right_on=&#39;file_name&#39;,
)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>def name_domain(chain_type: str, tcr_contact: bool) -&gt; str | None:
    match chain_type:
        case &#39;antigen_chain&#39;:
            return &#39;peptide&#39;

        case &#39;mhc_chain1&#39;:
            if tcr_contact:
                return &#39;mhc_tcr_contact&#39;

            return &#39;mhc&#39;

    return None

results[&#39;domain&#39;] = results.apply(lambda row: name_domain(row.chain_type, row.tcr_contact), axis=&#39;columns&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results[&#39;comparison&#39;] = results[&#39;state_x&#39;] + &#39;-&#39; + results[&#39;state_y&#39;]
results[&#39;comparison&#39;] = results[&#39;comparison&#39;].map(lambda entry: &#39;apo-holo&#39; if entry == &#39;holo-apo&#39; else entry)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results[&#39;structure_comparison&#39;] = results.apply(
    lambda row: &#39;-&#39;.join(sorted([row.structure_x_name, row.structure_y_name])),
    axis=&#39;columns&#39;,
)
results = results.drop_duplicates([&#39;structure_comparison&#39;, &#39;domain&#39;])
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>results = results.groupby([&#39;peptide_sequence&#39;,
                           &#39;mhc_slug&#39;,
                           &#39;comparison&#39;,
                           &#39;domain&#39;], dropna=False)[&#39;rmsd&#39;].mean().reset_index()
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>apo_holo_results = results.query(&quot;comparison == &#39;apo-holo&#39;&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>apo_holo_results
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>peptide_sequence</th>
      <th>mhc_slug</th>
      <th>comparison</th>
      <th>domain</th>
      <th>rmsd</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>AAGIGILTV</td>
      <td>hla_a_02_01</td>
      <td>apo-holo</td>
      <td>mhc</td>
      <td>0.660376</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAGIGILTV</td>
      <td>hla_a_02_01</td>
      <td>apo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>0.562211</td>
    </tr>
    <tr>
      <th>5</th>
      <td>AAGIGILTV</td>
      <td>hla_a_02_01</td>
      <td>apo-holo</td>
      <td>peptide</td>
      <td>1.025622</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ALHGGWTTK</td>
      <td>hla_a_03_01</td>
      <td>apo-holo</td>
      <td>mhc</td>
      <td>0.442792</td>
    </tr>
    <tr>
      <th>10</th>
      <td>ALHGGWTTK</td>
      <td>hla_a_03_01</td>
      <td>apo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>0.990352</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>339</th>
      <td>YGFRNVVHI</td>
      <td>h2_db</td>
      <td>apo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>0.829133</td>
    </tr>
    <tr>
      <th>340</th>
      <td>YGFRNVVHI</td>
      <td>h2_db</td>
      <td>apo-holo</td>
      <td>peptide</td>
      <td>0.275006</td>
    </tr>
    <tr>
      <th>344</th>
      <td>YLQPRTFLL</td>
      <td>hla_a_02_01</td>
      <td>apo-holo</td>
      <td>mhc</td>
      <td>0.647465</td>
    </tr>
    <tr>
      <th>345</th>
      <td>YLQPRTFLL</td>
      <td>hla_a_02_01</td>
      <td>apo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>0.476928</td>
    </tr>
    <tr>
      <th>346</th>
      <td>YLQPRTFLL</td>
      <td>hla_a_02_01</td>
      <td>apo-holo</td>
      <td>peptide</td>
      <td>0.512357</td>
    </tr>
  </tbody>
</table>
<p>176 rows × 5 columns</p>
</div></div>
</div>
</section>
</section>
<section id="Visualise-results">
<h2>Visualise results<a class="headerlink" href="#Visualise-results" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>sns.boxplot(apo_holo_results, x=&#39;domain&#39;, y=&#39;rmsd&#39;)

x = np.linspace(-0.75, 2.75)
y = np.repeat(NOISE_LEVEL, len(x))

plt.plot(x, y, &#39;--r&#39;)
plt.xlim(-0.75, 2.75)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/source_pMHC_movement_between_apo_and_holo_conformations_24_0.png" src="../_images/source_pMHC_movement_between_apo_and_holo_conformations_24_0.png" />
</div>
</div>
</section>
<section id="Compute-Statistics">
<h2>Compute Statistics<a class="headerlink" href="#Compute-Statistics" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>sns.displot(apo_holo_results, x=&#39;rmsd&#39;, col=&#39;domain&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;seaborn.axisgrid.FacetGrid at 0x7f4d5adf9f60&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/source_pMHC_movement_between_apo_and_holo_conformations_26_1.png" src="../_images/source_pMHC_movement_between_apo_and_holo_conformations_26_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>conditions = {domain: apo_holo_results[apo_holo_results[&#39;domain&#39;] == domain][&#39;rmsd&#39;].values for domain in apo_holo_results[&#39;domain&#39;].unique()}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>scipy.stats.f_oneway(*conditions.values())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
F_onewayResult(statistic=8.43958931017577, pvalue=0.0003181981364846825)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>combos = list(itertools.combinations(conditions.items(), 2))

significane_level = 0.05 / len(combos)

ad_hoc_results = {&#39;condition_x&#39;: [], &#39;condition_y&#39;: [], &#39;stat&#39;: [], &#39;p_val&#39;: []}
for (condition_x_name, condition_x), (condition_y_name, condition_y) in combos:
    ad_hoc_results[&#39;condition_x&#39;].append(condition_x_name)
    ad_hoc_results[&#39;condition_y&#39;].append(condition_y_name)

    stat, p_val = scipy.stats.ttest_ind(condition_x, condition_y)

    ad_hoc_results[&#39;stat&#39;].append(stat)
    ad_hoc_results[&#39;p_val&#39;].append(p_val)

ad_hoc_results = pd.DataFrame(ad_hoc_results)

ad_hoc_results[&#39;significant&#39;] = ad_hoc_results[&#39;p_val&#39;] &lt; significane_level

ad_hoc_results
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>condition_x</th>
      <th>condition_y</th>
      <th>stat</th>
      <th>p_val</th>
      <th>significant</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>mhc</td>
      <td>mhc_tcr_contact</td>
      <td>2.116838</td>
      <td>0.036411</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mhc</td>
      <td>peptide</td>
      <td>-2.531661</td>
      <td>0.012702</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mhc_tcr_contact</td>
      <td>peptide</td>
      <td>-3.322653</td>
      <td>0.001196</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Based on these results it seems that the peptide undergoes conformational change but not the MHC molecule- either TCR-contacting or not.</p>
</section>
<section id="Comparing-the-differences-in-binding-between-movement-types">
<h2>Comparing the differences in binding between movement types<a class="headerlink" href="#Comparing-the-differences-in-binding-between-movement-types" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>sns.catplot(results,
            x=&#39;comparison&#39;, y=&#39;rmsd&#39;,
            col=&#39;domain&#39;,
            kind=&#39;box&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/source_pMHC_movement_between_apo_and_holo_conformations_32_0.png" src="../_images/source_pMHC_movement_between_apo_and_holo_conformations_32_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>sns.displot(results,
            hue=&#39;comparison&#39;, x=&#39;rmsd&#39;,
            col=&#39;domain&#39;,
            kind=&#39;kde&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;seaborn.axisgrid.FacetGrid at 0x7f4d58acfe80&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/source_pMHC_movement_between_apo_and_holo_conformations_33_1.png" src="../_images/source_pMHC_movement_between_apo_and_holo_conformations_33_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>treatment_options = [&#39;comparison&#39;, &#39;domain&#39;]
treatments = [(group, df[&#39;rmsd&#39;].to_numpy()) for group, df in results.groupby(treatment_options)]
treatments
print(scipy.stats.kruskal(*[values for _, values in treatments]))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
KruskalResult(statistic=89.32014468652255, pvalue=6.389533459621575e-16)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre><span></span>combos = []
for pairing in list(itertools.combinations(treatments, 2)):
    domain_x = pairing[0][0][1]
    domain_y = pairing[1][0][1]

    if domain_x == domain_y:
        combos.append(pairing)

significance_level = 0.05 / len(combos)
print(significance_level)
statistics = []
p_vals = []

for ((comparison_x, domain_x), sample_x), ((comparison_y, domain_y), sample_y) in combos:
    stat, p_val = scipy.stats.ranksums(sample_x, sample_y)

    statistics.append(stat)
    p_vals.append(p_val)

momvement_type_statistics = pd.DataFrame({
    &#39;comparison_x&#39;: [name for ((name, _,), _), _ in combos],
    &#39;domain_x&#39;: [name for ((_, name), _), _ in combos],
    &#39;comparison_y&#39;: [name for _, ((name, _), _) in combos],
    &#39;domain_y&#39;: [name for _, ((_, name), _) in combos],
    &#39;statistic&#39;: statistics,
    &#39;p_val&#39;: p_vals,
    &#39;significant&#39;: [p_val &lt; significance_level for p_val in p_vals],
})

momvement_type_statistics[&#39;p_val&#39;] = momvement_type_statistics[&#39;p_val&#39;].map(lambda num: f&#39;{num:.2e}&#39;)

momvement_type_statistics
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.005555555555555556
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>comparison_x</th>
      <th>domain_x</th>
      <th>comparison_y</th>
      <th>domain_y</th>
      <th>statistic</th>
      <th>p_val</th>
      <th>significant</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>apo-apo</td>
      <td>mhc</td>
      <td>apo-holo</td>
      <td>mhc</td>
      <td>-4.766718</td>
      <td>1.87e-06</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>apo-apo</td>
      <td>mhc</td>
      <td>holo-holo</td>
      <td>mhc</td>
      <td>-2.895550</td>
      <td>3.78e-03</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>apo-apo</td>
      <td>mhc_tcr_contact</td>
      <td>apo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>-5.550086</td>
      <td>2.86e-08</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>apo-apo</td>
      <td>mhc_tcr_contact</td>
      <td>holo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>-3.288167</td>
      <td>1.01e-03</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>apo-apo</td>
      <td>peptide</td>
      <td>apo-holo</td>
      <td>peptide</td>
      <td>-5.087082</td>
      <td>3.64e-07</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>apo-apo</td>
      <td>peptide</td>
      <td>holo-holo</td>
      <td>peptide</td>
      <td>-3.533553</td>
      <td>4.10e-04</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>apo-holo</td>
      <td>mhc</td>
      <td>holo-holo</td>
      <td>mhc</td>
      <td>0.687756</td>
      <td>4.92e-01</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>apo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>holo-holo</td>
      <td>mhc_tcr_contact</td>
      <td>1.409336</td>
      <td>1.59e-01</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>apo-holo</td>
      <td>peptide</td>
      <td>holo-holo</td>
      <td>peptide</td>
      <td>0.228864</td>
      <td>8.19e-01</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Link to this heading"></a></h2>
<p>This analysis reveals that the peptide undergoes the most change from <em>apo</em> to <em>holo</em> states and the MHC molecule has little change between these states. It does not matter whether it is the TCR contacting portion of the MHC or not. The statistical analysis comparing the differences between comparion types gives inconclusive results.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pMHC_movement_based_on_peptide_anchoring.html" class="btn btn-neutral float-left" title="pMHC movement based on peptide anchoring" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="apps.html" class="btn btn-neutral float-right" title="Command Line Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Benjamin McMaster.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>